# Protocol Rule Processor Diamond Structure 

## Purpose

The Rule Processor Diamond is a proxy contract that is used by application contracts to assess economic actions against rules that are active within that handler. The Rule Processor will delegate those calls to the appropriate facet contract, allowing for efficient on chain rule assessments per transaction. The Rule Processor Diamond proxy also acts as a single source address for the creation of rules for application contracts. [Rule administrators](../../../permissions/ADMIN-ROLES.md) of an application are allowed to add rules to the Rule Processor storage. These rules are immutable once created and can be shared across different applications with the rule id number generated by the protocol. 

The Rule Processor diamond architecture consists of the Rule Processor Diamond, [Rule Processor Diamond Libraries](./RULE-PROCESSOR-LIBRARIES.md) and supporting [Rule Processor Facets](./RULE-PROCESSOR-FACETS.md). The library contracts store supporting functions for upgrading the diamond, connecting new facets, validating rule existence and supporting rule checks. The facet contracts fall into two categories: Storage Contracts and Processor Contracts. Storage contracts contain the data associated with a specific rule and the corresponding Processor contract contains the functions used to validate transactions relevant to the rule on chain. 

#### *[see diamond diagram](../../images/ProtocolOverview.png)*

### Diamond Pattern

The diamond pattern allows the protocol to upgrade, add new features and improvements through the use of a proxy contract. New facet contracts can be deployed and connected to the diamond via a specialized function called diamondCut. New facets and functions allow the protocol to grow while maintaining address immutability with the proxy contract. Calling contracts will only need to set the address of the diamond proxy at deployment, without having to worry about that address changing overtime. The Protocol Rule Processor follows ERC 2535 standards for storage and functions. 
#### *[ERC 2535: Diamond Proxies](https://eips.ethereum.org/EIPS/eip-2535)*

## Events
- **event AD1467_RuleProcessorDiamondDeployed()**: 
    - Emitted when: the Rule Processor Diamond is deployed.

### Upgrading 

Facets may be added or removed over time:

- [Upgrade a Rule Processor Facet](RULE-PROCESSOR-DIAMOND-UPGRADE.md).
- If an upgrade needs to be reverted, see [Revert a Diamond Upgrade](../common/DIAMOND-UPGRADE-REVERSION.md).